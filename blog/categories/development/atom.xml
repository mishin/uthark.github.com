<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: development | Software Development and related activities]]></title>
  <link href="http://uthark.github.com/blog/categories/development/atom.xml" rel="self"/>
  <link href="http://uthark.github.com/"/>
  <updated>2014-03-28T14:45:26-04:00</updated>
  <id>http://uthark.github.com/</id>
  <author>
    <name><![CDATA[Oleg Atamanenko]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Initializing Mockito @Mocks with JUnit @Rule]]></title>
    <link href="http://uthark.github.com/blog/2014/03/28/initializing-at-mocks-with-junit-at-rule/"/>
    <updated>2014-03-28T13:24:45-04:00</updated>
    <id>http://uthark.github.com/blog/2014/03/28/initializing-at-mocks-with-junit-at-rule</id>
    <content type="html"><![CDATA[<p>In this post I will show how one can implement custom JUnit <a href="http://junit-team.github.io/junit/javadoc/4.11/org/junit/Rule.html">@Rule</a>.</p>

<p>As an example let&rsquo;s take <a href="https://code.google.com/p/mockito/">Mockito</a> and implement custom rule which will initialize Mocks in  test class.</p>

<p>By default, Mockito provides the following methods of mock initialization:</p>

<ol>
<li>Using <a href="http://docs.mockito.googlecode.com/hg/org/mockito/Mockito.html#mock(java.lang.Class)">Mockito.mock</a></li>
</ol>


<p>``` java Initialize mocks with Mockito.mock
public void FooTest {</p>

<pre><code>private Foo foo;

@Before
public void setUp() {
    FooDependency dep = Mockito.mock(FooDependency.class);
    foo = new Foo(dep);
}
</code></pre>

<p>}
```</p>

<p>This is the simplest case.</p>

<ol>
<li>Using <a href="http://docs.mockito.googlecode.com/hg/org/mockito/MockitoAnnotations.html#initMocks(java.lang.Object)">MockitoAnnotations</a>.</li>
</ol>


<p>``` java Initialize mocks with MockitoAnnotations
public void FooTest {</p>

<pre><code>private Foo foo;

@Mock
private FooDependency dep;

@Before
public void setUp() {
    MockitoAnnotations.initMocks(this);
    foo = new Foo(dep);
}
</code></pre>

<p>}
```</p>

<p>This method is useful when you have a lot of mocks to inject.</p>

<ol>
<li><p>Using <a href="http://docs.mockito.googlecode.com/hg/org/mockito/runners/MockitoJUnitRunner.html">MockitoJUnitRunner</a>
``` java Initialize mocks with MockitoJUnitRunner
@RunWith(MockitoJUnitRunner.class)
public void FooTest {</p>

<p>  private Foo foo;</p>

<p>  @Mock
  private FooDependency dep;</p>

<p>  @Before
  public void setUp() {
      foo = new Foo(dep);
  }
}
```</p></li>
</ol>


<p>I want to show you another method, by using custom JUnit <code>@Rule</code>.</p>

<p>First, we need to implement <a href="http://junit-team.github.io/junit/javadoc/4.11/org/junit/rules/TestRule.html">TestRule</a> interface which allows to implement custom behaviour during test execution:</p>

<p>``` java MockitoInitializerRule
public class MockitoInitializerRule implements TestRule {</p>

<pre><code>private Object test;

public MockitoInitializerRule(Object test) {
    this.test = test;
}

@Override
public Statement apply(Statement base, Description description) {
    return new MockitInitilizationStatement(base, test);
}
</code></pre>

<p>}
```</p>

<p>We need to pass current test class instance to the rule, so it will be possible inject mocks into class instance. Actual implementation of our rule will go to new class &ndash; subclass of <a href="http://junit-team.github.io/junit/javadoc/4.11/org/junit/runners/model/Statement.html">Statement</a>:</p>

<p>``` java MockitInitilizationStatement
class MockitInitilizationStatement extends Statement {</p>

<pre><code>private final Statement base;
private Object test;

MockitInitilizationStatement(Statement base, Object test) {
    this.base = base;
    this.test = test;
}

@Override
public void evaluate() throws Throwable {
    MockitoAnnotations.initMocks(test);
    base.evaluate();
}
</code></pre>

<p>}</p>

<p>```</p>

<p>What we do is basically initialize mocks in the test class and then proceed with the test method execution.</p>

<p>Now, let&rsquo;s take a look at the usage of newly created Rule:</p>

<p>``` java Example usage of MockitoInitializerRule
public void FooTest {</p>

<pre><code>private Foo foo;

@Mock
private FooDependency dep;

@Rule
public TestRule mockitoInitializerRule = new MockitoInitializerRule(this);

@Before
public void setUp() {
    foo = new Foo(dep);
}
</code></pre>

<p>}
```</p>

<p>Comparing to variant with <code>MockitoJUnitRunner</code> this one provides ability to use custom <a href="http://junit-team.github.io/junit/javadoc/4.11/org/junit/runner/Runner.html">Runner</a>, i.e. we can continue to use <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/test/context/junit4/SpringJUnit4ClassRunner.html">SpringJUnit4ClassRunner</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using custom font in Android TextView]]></title>
    <link href="http://uthark.github.com/blog/2014/03/06/customizing-font-in-android-textview/"/>
    <updated>2014-03-06T19:13:17-05:00</updated>
    <id>http://uthark.github.com/blog/2014/03/06/customizing-font-in-android-textview</id>
    <content type="html"><![CDATA[<p>Today I want to share with you custom <a href="http://developer.android.com/reference/android/widget/TextView.html">TextView</a> which allows to set font to be used in xml layout.</p>

<p>First, we need to declare our custom styleable</p>

<p>``` xml attrs.xml
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;utf-8&rdquo;?>
<resources></p>

<pre><code>&lt;declare-styleable name="TypefaceTextView"&gt;
    &lt;attr name="typeface" format="string"/&gt;
&lt;/declare-styleable&gt;
</code></pre>

<p></resources></p>

<p>```</p>

<p>Then we need to create subclass of <code>TextView</code> which will use custom attribute.</p>

<p>``` java TypefaceTextView
public class TypefaceTextView extends TextView {</p>

<pre><code>public TypefaceTextView(Context context) {
    this(context, null);
}

public TypefaceTextView(Context context, AttributeSet attrs) {
    this(context, attrs, 0);
}

public TypefaceTextView(Context context, AttributeSet attrs, int defStyle) {
    super(context, attrs, defStyle);

    TypedArray ta = context.getTheme().obtainStyledAttributes(attrs, R.styleable.TypefaceTextView, 0, 0);
    try {
        String font = ta.getString(R.styleable.TypefaceTextView_typeface);
        if (null == font) {
            font = context.getString(R.string.default_font_name);
        }
        Typeface typeface = TypefaceCache.getTypeface(context, font);
        if (null != typeface) {
            setTypeface(typeface);
        }

    } finally {
        ta.recycle();
    }
}
</code></pre>

<p>}
```</p>

<p>Also, above class allows to use default custom font, all is needed is to define its name in <code>strings.xml</code></p>

<p>```
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;utf-8&rdquo;?>
<resources></p>

<pre><code>&lt;string name="default_font_name" translatable="false"&gt;custom.ttf&lt;/string&gt;
</code></pre>

<p></resources>
```</p>

<p>Due to the <a href="https://code.google.com/p/android/issues/detail?id=9904">bug in Android</a> we have to cache all created typefaces in cache:</p>

<p>``` java TypefaceCache
public class TypefaceCache {</p>

<pre><code>private static final Map&lt;String, Typeface&gt; CACHE = new HashMap&lt;String, Typeface&gt;();

public static Typeface getTypeface(Context context, String font) {
    if (null == font) {
        return null;
    }
    Typeface typeface = CACHE.get(font);
    if (null == typeface) {

        typeface = Typeface.createFromAsset(context.getAssets(), font);
        CACHE.put(font, typeface);
    }
    return typeface;
}
</code></pre>

<p>}</p>

<p>```</p>

<p>Basically, that&rsquo;s it. In order to use it is required to put TTF font in the <code>assets</code> folder and reference the font:</p>

<p>``` xml Example usage.
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;utf-8&rdquo;?>
&lt;com.example.android.widget.TypefaceTextView</p>

<pre><code>xmlns:a="http://schemas.android.com/apk/res/android"
xmlns:custom="http://schemas.android.com/apk/res-auto"
a:layout_width="match_parent"
custom:typeface="custom-font.ttf"/&gt;
</code></pre>

<p>```</p>

<p>And the last use case it to set custom font for the actionbar title. In this case we can implement custom <a href="http://developer.android.com/reference/android/text/style/CharacterStyle.html"><code>android.text.style.CharacterStyle</code></a></p>

<p>``` java TypefaceSpan
public class TypefaceSpan extends MetricAffectingSpan {</p>

<pre><code>private Typeface mTypeface;

/**
 * Load the {@link Typeface} and apply to a {@link Spannable}.
 */
public TypefaceSpan(Context context, String typefaceName) {
    mTypeface = TypefaceCache.getTypeface(context, typefaceName);
}

@Override
public void updateMeasureState(TextPaint p) {
    p.setTypeface(mTypeface);

    // Note: This flag is required for proper typeface rendering
    p.setFlags(p.getFlags() | Paint.SUBPIXEL_TEXT_FLAG);
}

@Override
public void updateDrawState(TextPaint tp) {
    tp.setTypeface(mTypeface);

    // Note: This flag is required for proper typeface rendering
    tp.setFlags(tp.getFlags() | Paint.SUBPIXEL_TEXT_FLAG);
}
</code></pre>

<p>}
```</p>

<p>Then we can set actionbar title using the following code:</p>

<p>``` java
public static void setActionBarTitle(Activity context, CharSequence title) {</p>

<pre><code>SpannableString s = new SpannableString(title);
s.setSpan(new TypefaceSpan(context, context.getString(R.string.default_font_name)), 0, s.length(),
    Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);

if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) {
    context.getActionBar().setTitle(s);
}
</code></pre>

<p>}
```</p>

<h3>Additional information</h3>

<ol>
<li><a href="http://developer.android.com/training/custom-views/#create-view.html">Creating a View Class | Android Developers</a></li>
</ol>

]]></content>
  </entry>
  
</feed>
